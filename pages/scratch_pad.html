<!DOCTYPE html>
<html lang="en">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>inoloc Solution-Consulting</title>
		<link href="../css/bootstrap.min.css" rel="stylesheet">
		<link href="../css/main.css" rel="stylesheet">
		<link href="../css/scratch_pad.css" rel="stylesheet">
		<script src="../js/jquery-2.1.4.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script>
  			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			  ga('create', 'UA-56668373-6', 'auto');
			  ga('send', 'pageview');

		</script>
	</head>

	<body>
		<div class="container-fluid" id="logo">
			<img src="../media/inoloc.png" id="logoIcon">
		</div>
		<nav class="navbar navbar-default" id="headerNav">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navigationBar">
						<span class="icon-bar"></span>
					    <span class="icon-bar"></span>
					    <span class="icon-bar"></span> 
					</button>
				</div>
				<div class="navbar-collapse collapse" id="navigationBar">
					<ul class="nav navbar-nav" id="navigationList">
						<li><a href="../index.html">Home</a></li>
						<li><a href="aboutus.html">About Us</a></li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button">Products and Services<span class="caret"></span></a>
							<ul class="dropdown-menu">
								<li><a href="iOSapplications.html">iOS Applications</a></li>
							</ul>
						</li>
						<li><a href="#">Scratch Pad</a></li>
						<li><a href="contactus.html">Contact Us</a></li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="container-fluid" id="pageContent">
			<div class="row">
				<div class="col-md-12">
					<h1>Welcome to Scratch Pad! Here we plan to post on really anything from an editorial to a tutorial to just some random musing on something that interests us.</h1>
					<h2>How to make a NAS RAID 0 backup drive for Macs using a Raspberry Pi</h2>
					<h5>Published: 11/4/15</h5>
					<p>Have you ever wanted a RAID network back up drive but not want to pay hundreds of dollars? Have you wanted one that is formatted especially for your Mac? I set out to create a cheap NAS RAID 0 with a Raspberry Pi. I tried finding online tutorials, but the ones for Mac were few in number and there were a few missing pieces. Thus, I hope that this explicit set of instructions works out for you.</p>
					<p>I want to give credit where credit is due, so these are some of the srouces I consulted while figuring things out:</p>
					<ul>
						<li><a href="http://raspipress.com/2013/05/turn-a-raspberry-pi-into-a-nas-network-attached-storage-server/">http://raspipress.com/2013/05/turn-a-raspberry-pi-into-a-nas-network-attached-storage-server/</a></li>
						<li><a href="http://www.howtogeek.com/139433/how-to-turn-a-raspberry-pi-into-a-low-power-network-storage-device/">http://www.howtogeek.com/139433/how-to-turn-a-raspberry-pi-into-a-low-power-network-storage-device/</a></li>
						<li><a href="https://raspberrypibeginner.wordpress.com/2013/03/05/mounting-hfs-from-mac-to-rpi/">https://raspberrypibeginner.wordpress.com/2013/03/05/mounting-hfs-from-mac-to-rpi/</a></li>
						<li><a href="http://pimylifeup.com/raspberry-pi-nas/">http://pimylifeup.com/raspberry-pi-nas/</a></li>
					</ul>
					<p>Without further ado, here's the instructions. Feel free to contact me if you need some help</p>
					<ol>
						<li>Install NOOBs and Raspbian Weezy on your Raspberry Pi <a href="https://www.raspberrypi.org/documentation/installation/noobs.md">https://www.raspberrypi.org/documentation/installation/noobs.md</a></li>
						<li>Make sure that you enable SSH <a href="https://www.raspberrypi.org/documentation/configuration/raspi-config.md">https://www.raspberrypi.org/documentation/configuration/raspi-config.md</a></li>
						<li>Connect your Raspberry Pi to your network <a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md</a></li>
						<li>SSH into your Raspberry Pi to work from your Mac <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/README.md">https://www.raspberrypi.org/documentation/remote-access/ssh/README.md</a></li>
						<li>Before plugging in your harddrives to your Raspberry Pi, open up Disk Utility on your mac and format the drives as Mac OS X Extended (Journaled) with Master Boot Record selected as the sub option. I believe that this allows the drive to be read by Windows computers (like on Bootcamp) just in case</li>
						<li>Type <code>sudo apt-get update</code> to update the pi.</li>
						<li>Type <code>sudo apt-get install hfsplus hfsutils hfsprogs</code> to install the HFS tools.</li>
						<li>Type <code>sudo apt-get install samba samba-common-bin</code> to install the samba server</li>
						<li>Type <code>sudo apt-get install rsync</code> to install the rsync tools that we'll use to automatically copy information between drives.</li>
						<li>Now, type <code>sudo fdisk -l</code> and look for two things. The first is to check that the drives show up as HFS+ under the System column. The second is to write down the names of the drives, such as /dev/sdb1.</li>
						<li>Make 2 directories that drives will be mounted to <code>sudo mkdir /media/NASHDD1</code> and <code>sudo mkdir /media/NASHDD2</code></li>
						<li>Create a user for yourself, besides the one that you may have made when setting up the pi. This will be used to log into your Backup drive. <code>sudo useradd insert_user_name -m -g users</code></li>
						<li>Add a password to that user account: <code>sudo passwd your_user_name</code></li>
						<li>We now need to automatically mount the harddrives to the correct folders. Open up the fstab file with the command: <code>sudo nano /etc/fstab</code>. Then, add the following lines<br /><code>HD1_name_from_step_10	/media/NASHDD1	hfsplus	force,rw,user   0    0</code><br /><code>HD2_name_from_step_10	/media/NASHDD2	hfsplus	force,rw,user   0    0</code><br />Make sure to save the file.
						</li>
						<li>Make a backup of the Samba config file: <code>sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.old</code></li>
						<li>Time to edit the Samba config file: <code>sudo nano /etc/samba/smb.conf</code></li>
						<li>In this file, uncomment the line with "security = user". Then, scroll to the bottom and add the following:<br />
							<code>[Backup]
								<br />comment = Back up NAS Folder
								<br />path = /media/NASHDD1
								<br />valid users = @users
								<br />force group = users
								<br />create mask = 0660
								<br />directory mask = 0771
								<br />read only = no
							</code>
							<br />Make sure you save the file.
						</li>
						<li>Restart Samba <code>sudo /etc/init.d/samba restart</code></li>
						<li>Add the user you created earlier to Samba: <code>sudo smbpasswd -a your_username_from_before</code></li>
						<li>This took me forever to figure out. For some reason, you have to set the permissions for the user to be able to access the HFS hard drives. This seemed to have to do with Mac formatted drives in linux.<br /><code>sudo chown -R your_username /media/NASHDD1</code><br />
						<code>sudo chown -R your_username /media/NASHDD2</code></li>
						<li>Go ahead and reboot your Raspberry Pi to mount the drives with <code>sudo reboot</code></li>
						<li>SSH in again and do the <code>df</code> command to ensure that your drives are mounted correctly.</li>
						<li>Finally, it's time to make the "RAID 0" part. Open up the cron job list with <code>crontab -e</code></li>
						<li>Add the line <code>0 5 * * * sudo rsync -av --delete /media/NASHDD1/ /media/NASHDD2/</code> to the end. You can refer to the above links to better understand what the various aspects mean, but basically we want to copy the contents of the first hard drive autommatically into the second hard drive.</li>
						<li>To make the initial load lighter, you can copy some files in and run <code>sudo rsync -av --delete /media/NASHDD1/ /media/NASHDD2</code></li>
					</ol>
					<p>Now you should have a fully functioning back up drive!</p>
				</div>
			</div>
		</div>
		<footer class="footer">
      		<div class="container-fluid">
        		<p class="text-center">inoloc 2015</p>
      		</div>
    	</footer>
	</body>
</html>